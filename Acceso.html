<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Acceso ‚Äì MetradorPro</title>
  <style>
    body{font-family:system-ui,Arial,sans-serif;max-width:520px;margin:40px auto;padding:0 16px}
    .card{border:1px solid #ddd;border-radius:12px;padding:16px}
    input,button{width:100%;padding:10px;margin:6px 0;border-radius:8px;border:1px solid #ccc}
    button{cursor:pointer}.ok{color:#0a7d00}.warn{color:#b00020}
    .row{display:grid;grid-template-columns:1fr 1fr;gap:8px}
  </style>
</head>
<body>
  <h1>Acceso al Visualizador PRO</h1>
  <div class="card">
    <label>Correo</label>
    <input id="email" type="email" placeholder="tu@correo.com" autocomplete="email" />
    <label>Contrase√±a</label>
    <input id="pass" type="password" placeholder="M√≠nimo 6 caracteres" autocomplete="current-password" />
    <div class="row">
      <button id="btnReg">Crear cuenta</button>
      <button id="btnLogin">Iniciar sesi√≥n</button>
    </div>
    <button id="btnVerif">Reenviar verificaci√≥n</button>
    <button id="btnLogout">Cerrar sesi√≥n</button>
    <p id="msg"></p>
  </div>
  <p id="estado"></p>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getAuth, onAuthStateChanged, createUserWithEmailAndPassword,
      signInWithEmailAndPassword, sendEmailVerification, signOut, getIdToken
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    // üîÅ PEG√Å AC√Å TU CONFIG DE FIREBASE
    const firebaseConfig = {
      apiKey: "TU_API_KEY",
      authDomain: "TU_AUTH_DOMAIN",
      projectId: "TU_PROJECT_ID",
      appId: "TU_APP_ID",
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    auth.languageCode = 'es';

    const $ = (id)=>document.getElementById(id);
    const setMsg=(t,cls='')=>{const m=$('msg');m.textContent=t;m.className=cls;};

    $('btnReg').onclick = async () => {
      try {
        const u = await createUserWithEmailAndPassword(auth, $('email').value, $('pass').value);
        await sendEmailVerification(u.user);
        setMsg("Cuenta creada. Te envi√© un correo para verificar.", "ok");
      } catch(e){ setMsg(e.message,'warn'); }
    };

    $('btnLogin').onclick = async () => {
      try {
        const u = await signInWithEmailAndPassword(auth, $('email').value, $('pass').value);
        if (!u.user.emailVerified) return setMsg("Tu correo no est√° verificado.", "warn");
        const token = await getIdToken(u.user, true);
        localStorage.setItem('uid', u.user.uid);
        localStorage.setItem('email', u.user.email);
        localStorage.setItem('idToken', token);
        setMsg("Sesi√≥n iniciada y verificada. ¬°Listo!", "ok");
        // window.location.href = "index.html"; // si quer√©s redirigir
      } catch(e){ setMsg(e.message,'warn'); }
    };

    $('btnVerif').onclick = async () => {
      if (auth.currentUser) { await sendEmailVerification(auth.currentUser); setMsg("Correo reenviado.", "ok"); }
      else setMsg("Primero inici√° sesi√≥n.", "warn");
    };

    $('btnLogout').onclick = async () => {
      await signOut(auth);
      localStorage.removeItem('uid'); localStorage.removeItem('email'); localStorage.removeItem('idToken');
      setMsg("Sesi√≥n cerrada.", "ok");
    };

    onAuthStateChanged(auth, async (u) => {
      $('estado').textContent = u ? `Conectado como ${u.email} ‚Äî ${u.emailVerified?'‚úÖ verificado':'‚õî no verificado'}` : "No has iniciado sesi√≥n.";
      if (u) { try { localStorage.setItem('idToken', await getIdToken(u,true)); } catch{} }
    });
  </script>
</body>
</html>
